
#use json

Функция ВернутьНастройкиИзJSONФайла(ИмяФайла, ТипНастройки = "Соответствие")
	fil = Новый Файл(ИмяФайла);
	Если Не fil.Существует() Тогда
		Сообщить("Не найден файл настроек "+ИмяФайла);
		Возврат Неопределено;
	КонецЕсли;

  jsn = Новый ПарсерJSON;
  ОбъектДж = jsn.ПрочитатьJSON(Новый ЧтениеТекста(ИмяФайла).Прочитать());
  Если ТипЗнч(ОбъектДж) <> Тип(ТипНастройки) Тогда
    Сообщить("Неправильная структура файла конфигурации "+ИмяФайла+" (Тип: "+ ТипЗнч(ОбъектДж)+"<> "+ТипНастройки+")");
		Возврат Неопределено;
  КонецЕсли;
  Возврат ОбъектДж;
КонецФункции

Процедура Инициализировать(глСкрипт, Отказ) Экспорт

	глСкрипт._ = ВернутьНастройкиИзJSONФайла("main.json");
	Если глСкрипт._ = Неопределено Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	задачи = ВернутьНастройкиИзJSONФайла(глСкрипт._["tsk_lst"]);


	Если задачи = Неопределено Тогда
		Отказ = Истина;
		Возврат;
	Иначе
			глСкрипт._.Вставить("tasks", задачи);
	КонецЕсли;
	Ибазы = ВернутьНастройкиИзJSONФайла("master_ib.json");
	Если Ибазы = Неопределено Тогда
		Отказ = Истина;
		Возврат;
	Иначе
			глСкрипт._.Вставить("ib_connStr", Ибазы);
	КонецЕсли;
КонецПроцедуры

